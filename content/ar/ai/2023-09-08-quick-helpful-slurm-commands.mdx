---
title: أوامر Slurm سريعة ومفيدة
description: دليل سريع لاستخدام Slurm لتعلّم الآلة الموزّع.
date: "2023-09-08"
tags: [ml/ai]
---

في المختبر الذي أعمل فيه، لدينا إمكانية الوصول إلى بيئة حوسبة عالية الأداء (HPC) تستخدم [Slurm Workload Manager](https://slurm.schedmd.com/documentation.html).

أستخدمه منذ مدة، وقد عثرت على بعض الأوامر التي أعود إليها باستمرار. رأيت أن أشاركها هنا لعلها تفيد غيري أيضًا.

## التحقُّق من حالة الوظيفة

```bash
# عرض جميع المهام
squeue
# فحص حالة مهامك فقط
squeue -u <username>
# فحص حالة المهام بـ QOS محدد
squeue -q <QOS>
```


## إلغاء الوظائف

```bash
# إلغاء مهمة محددة
scancel <job_id>
# إلغاء جميع مهامك
scancel -u <username>
```


## طلب عقدة بطريقة تفاعلية

```bash
# طلب عقدة واحدة (سيؤدي هذا إلى فتحها بشكل تفاعلي في الطرفية الخاصة بك)
# عند الخروج من الطرفية، سيتم إعادة تخصيص العقدة
salloc --nodes=1 --gpus=8 --qos=<QOS> --mem=2000G --time=72:00:00 --ntasks=1 --cpus-per-task=128
```


## إرسال مهمة

ماذا لو كانت جميع عقد الحوسبة لديك مُخصَّصة بالفعل، أو أنك لا تريد لمهمتك أن تتوقّف بمجرد إغلاق اتصال الطرفية؟ في هذه الحالة، يمكنك استخدام `sbatch` لإرسال مهمة إلى قائمة الانتظار. ستبدأ التنفيذ تلقائيًا بمجرد تمكنها من تخصيص الموارد.

سيحتاج هذا إلى إعدادٍ أكثر قليلًا. لنفترض أن المهمة التي نريد تشغيلها فعليًا موجودة في `myjob.sh`. ولإرسال ذلك السكربت كمهمة، سنُنشئ أولًا سكربت Bash ستقوم Slurm بتشغيله. دعونا نسميه `run.sh`:

```bash
#!/bin/bash
#SBATCH -J "اسم_المهمة"
#SBATCH --nodes=1
#SBATCH --gpus-per-node=8
#SBATCH --cpus-per-task=128
#SBATCH --mem=2000G
#SBATCH --time=72:00:00
#SBATCH --qos=<جودة_الخدمة>

srun --nodes=1 myjob.sh
```

لاحظ أننا نستخدم توجيه المعالجة ‎`#SBATCH`‎ لتمرير الوسائط التي كنا سنمررها إلى ‎`salloc`‎ من قبل. نستخدم أيضًا ‎`srun`‎ لتشغيل المهمة الفعلية؛ إذ يتولّى تشغيل السكربت عبر عدة عقد إذا أردنا ذلك.

أخيرًا، لتشغيل السكربت، سننفّذ:

```bash
sbatch run.sh
```


## الخلاصة

هذا كل شيء! آمل أن يكون هذا مفيدًا. إذا كانت لديك أي أسئلة، يمكنك سؤال ChatGPT أو Bard (فقد يقدّمان إجابات مفيدة جدًا أو غير دقيقة تمامًا، لكن لا ضير من المحاولة!)

يمكنك أيضًا الاطلاع على [توثيق Slurm](https://slurm.schedmd.com/documentation.html) أو صفحة [ملاحظات Leo](https://leo.leung.xyz/wiki/Slurm) عن Slurm لمزيد من المعلومات.