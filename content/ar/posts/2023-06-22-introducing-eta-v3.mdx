---
title: تقديم Eta v3
description: الإصدار الجديد من Eta، وهو محرك قوالب JavaScript مُضمَّن، يقدّم تحسينات على واجهة برمجة التطبيقات والوثائق.
date: "2023-06-22"
tags: [open-source]
---

## الخلفية

اليوم تُعد Eta مشروعي المفتوح المصدر الأكثر انتشارًا واستخدامًا. لكن عندما نشرتها لأول مرة قبل 3 سنوات، لم تكن ضمن أولوياتي الرئيسية. في الواقع، أنشأت Eta كنسخة مُخفّفة من [Squirrelly](https://squirrelly.js.org)، وهو محرّك قوالب أكثر تعقيدًا يتضمن ميزات مثل المساعدات والمرشّحات.

مع مرور الوقت، أدركت أن محرّك قوالب مُضمَّن هو في الواقع أنسب لمعظم المشاريع من خيار أكثر تعقيدًا. فالمشاريع التي تحتاج إلى معالجة HTML معقّدة أو على جهة العميل كانت عادةً تستخدم إطارًا مثل React أو Vue. في المقابل، جعل أداء Eta وحجم حزمته المنخفض منه خيارًا ممتازًا للمشاريع التي تحتاج إلى معالجة سريعة، واستهلاك ذاكرة منخفض، أو التعامل مع لغات غير قائمة على XML.

في الوقت نفسه، ازدادت شعبية Eta بفضل سرعتها، ودعمها لـ Deno، وتفوّق بنية صياغتها مقارنةً بـ EJS. وبالنظر إلى تلك العوامل، قررت أن أجعل Eta محط تركيزي الرئيسي. قضيت وقتًا في كتابة دروس، وإصلاح المشكلات، وصقل الوثائق.

بعد عدة سنوات وبعض الوقت بعيدًا عن البرمجة في مهمة تبشيرية، صار لدي أخيرًا وقت للعمل على Eta مرة أخرى. قررت إجراء تغييرات كبيرة على المشروع، بما في ذلك نظام البناء، والواجهة البرمجية (API)، والوثائق.

## تحديثات نظام البناء

على الرغم من مزايا Eta وخصائصه، كانت هناك بعض المشكلات الكبيرة. إحدى هذه المشكلات كانت نظام البناء. كان معقّدًا وصعب التعامل معه، مما جعل صيانته وتحديثه أمرًا شاقًا. اضطررتُ للتعامل مع ملفات ضبط معقّدة والحاجة إلى تحويل نسخة مخصّصة لـ Deno.

التغييرات في الإصدار 3:

- استخدام [microbundle](https://github.com/developit/microbundle) لحزم المكتبة ساعدني في تجنّب الحاجة إلى ملفات ضبط معقّدة.
- استخدام GitHub Actions لتشغيل الاختبارات وجمع التغطية أتاح لي توحيد الخدمات التي أستخدمها.
- من خلال ضبط `allowImportingTsExtensions: true` في `tsconfig.json`، تمكنتُ من الاستغناء عن استخدام [Denoify](https://github.com/garronej/denoify) لبناء منفصل لـ Deno.

## تغييرات واجهة برمجة التطبيقات (API)

كانت هناك مشكلة أخرى في واجهة برمجة التطبيقات. فقد احتوت الأساليب البسيطة مثل `eta.render()` على العديد من الصيغ (overloads)، ما جعل استنتاج الأنواع صعبًا والاستخدام غير بديهي. كان بالإمكان تمرير كائن إعدادات مخصص عند استدعاء الدوال المتاحة للمستخدم مثل `render` و`parse` و`compile`. عمليًا، كان ذلك يعني ضرورة دمج إعدادات المستخدم مع الإعدادات الافتراضية في كل مرة تُستدعى فيها أي من تلك الدوال.

التغييرات في الإصدار 3:

- هناك تصدير واحد فقط، وهو فئة باسم `Eta`. تحتوي هذه الفئة على مُنشئ واحد يعالج كائن الإعدادات ويُنشئ ذاكرات تخزين مؤقتة للقوالب وقت الإنشاء.
- أصبحت دالتا `render()` و`renderAsync()` تملكان الآن توقيعًا واحدًا.
  - في Eta v2، كان يمكن استخدام `render()` و`renderAsync()` لعرض قوالب مُسمّاة أو سلاسل قوالب. يقدّم Eta v3 دالتين جديدتين لعرض سلاسل القوالب: `renderString()` و`renderStringAsync()`.
- يمكن للمستخدم تجاوز دالتي `readFile()` و`resolvePath()` اللتين تستخدمهما Eta داخليًا، كطرائق ضمن الفئة.
- تُخزَّن المتغيرات والطرائق الداخلية داخل كل قالب مُجمَّع في كائن `__eta` بدلًا من توزيعها عبر عدة متغيرات بما فيها `__res`.
- بدلًا من السماح للمستخدمين بتحديد دليل `root` واحد وعدة أدلة `views`، يمكنهم تحديد دليل `views` واحد فقط. يُستخدم هذا الدليل كجذر لحل جميع القوالب. يجب أن تكون جميع ملفات القوالب داخل هذا الدليل أو أحد أدلته الفرعية، ما يعزّز أمان القوالب ويقلّل من عمليات البحث المكلفة عن الملفات.

## تغييرات تجربة المطوّر

من أكبر التغييرات في Eta v3 إضافة أخطاء وقت التشغيل التفصيلية (بتأثير من EJS). تأمّل قالبًا مثل التالي، والذي سيُطلق خطأً بسبب متغيّر غير معرّف:

```eta
رأس القالب
<%= undefinedVariable %>
لوريم إيبسوم
```

كانت Eta v2 تُظهر خطأً مع بعض المعلومات العامة، لكنها لم تكن مفيدة جدًا. في المقابل، تعرض Eta v3 خطأً تفصيليًا يتضمّن اسم القالب ورقم السطر ورسالة الخطأ:

```text
EtaError [ReferenceError]: .../my-dir/templates/runtime-error.eta:2
    1| عنوان القالب
 >> 2| <%= undefinedVariable %>
    3| لوريم إيبسوم

undefinedVariable غير معرّف
```


## تغييرات التوثيق

كان توثيق Eta v2 واسعًا لكنه شديد الصعوبة في التصفّح. كانت معلومات المشروع موزعة على أكثر من 40 (!) صفحة توثيق، ضمن عدة مجلدات منتشرة عبر ثلاثة أقسام مختلفة من الموقع.

يقتصر توثيق Eta v3 على تسع صفحات، كلها موجودة في القسم نفسه من الموقع ([eta.js.org](https://eta.js.org)). تُغطّى مواضيع مثل بنية القوالب ونظرة عامة على واجهة برمجة التطبيقات في صفحة واحدة بدلًا من تشتيتها على عدة صفحات.

## مستقبل Eta

أنا فخور بالتغييرات التي يتضمّنها Eta v3، وبالمشروع ككل. جزيل الشكر لكل من ساهم في المشروع عبر طلبات السحب (PRs) والقضايا (issues) والمقترحات (suggestions). كما أشكر مشاريع مثل [ejs](https://github.com/mde/ejs) التي يواصل Eta استلهام الأفكار منها.

أرى أن Eta شبه مكتمل من حيث الميزات في هذه المرحلة، وسأواصل إصلاح الأخطاء وإضافة بعض الميزات الصغيرة. أشجّع مستخدمي المكتبة الحاليين على الترقية إلى v3، وآمل أن يجد المستخدمون الجدد في Eta خيارًا رائعًا لمشاريعهم.

## روابط

- [Eta على GitHub](https://github.com/eta-dev/eta)
- [Eta على npm](https://www.npmjs.com/package/eta)
- [موقع Eta والتوثيق](https://eta.js.org)