---
title: "PÅ™idÃ¡nÃ­ .md URL pro syrovÃ½ obsah Markdownu v Next.js"
description: "Jak pÅ™idat .md URL do svÃ©ho Next.js blogu a servÃ­rovat syrovÃ½ obsah Markdownu, inspirovÃ¡no dokumentacÃ­ Vercelu."
date: "2025-06-14"
tags: [frontend]
---

> **Aktualizace**: Po zveÅ™ejnÄ›nÃ­ tohoto pÅ™Ã­spÄ›vku [Guillermo Rauch](https://twitter.com/rauchg) (CEO Vercelu) doporuÄil pro tento ÃºÄel pouÅ¾Ã­t v Next.js pÅ™episy (rewrites) mÃ­sto middleware. Implementaci nÃ­Å¾e jsem aktualizoval â€“ je jednoduÅ¡Å¡Ã­ a vÃ½konnÄ›jÅ¡Ã­! ğŸš€

## StruÄnÄ›

InspirovÃ¡no dokumentacÃ­ Vercelu pÅ™idÃ¡me moÅ¾nost pÅ™ipojit k libovolnÃ© URL pÅ™Ã­spÄ›vku na blogu `.md`, abyste zÃ­skali syrovÃ½ obsah v Markdownu. TakÅ¾e `/posts/my-post` se pro zÃ­skÃ¡nÃ­ zdrojovÃ©ho obsahu zmÄ›nÃ­ na `/posts/my-post.md`. NedÃ¡vno jsem tuhle funkci pÅ™idal i na svÅ¯j blog â€“ skvÄ›lÃ© na sdÃ­lenÃ­ ukÃ¡zek kÃ³du nebo kdyÅ¾ chcete lidem ukÃ¡zat, jak jste nÄ›co napsali.

Next.js [rewrites](https://nextjs.org/docs/app/api-reference/config/next-config-js/rewrites) z toho dÄ›lajÃ­ pÅ™ekvapivÄ› Äistou a snadnou implementaci.

<Tweet id="1930689104800518392" />

## NastavenÃ­

```bash
pnpx create-next-app@latest raw-markdown-blog
cd raw-markdown-blog
pnpm install @content-collections/core @content-collections/mdx @content-collections/next zod
```

Zvolte TypeScript, Tailwind CSS a App Router.

PÅ™idejte `.content-collections` do souboru `.gitignore`:

```
.content-collections
```


## NastavenÃ­ Content Collections

[Content Collections](https://www.content-collections.dev/) je skvÄ›lÃ¡ knihovna pro sprÃ¡vu obsahu v Next.js â€“ je type-safe, rychlÃ¡ a mÃ¡ skvÄ›lÃ© DX.

VytvoÅ™te soubor `content-collections.ts` v koÅ™enovÃ© sloÅ¾ce projektu (ne v src/):

```typescript
import { defineCollection, defineConfig } from "@content-collections/core";
import { compileMDX } from "@content-collections/mdx";
import { z } from "zod";

const posts = defineCollection({
  name: "posts",
  directory: "content",
  include: "**/*.mdx",
  schema: z.object({
    title: z.string(),
    description: z.string(),
    date: z.string().pipe(z.coerce.date()),
  }),
  transform: async (document, context) => {
    const mdx = await compileMDX(context, document);
    const slug = document._meta.path.replace(/\.mdx$/, "");

    return {
      ...document,
      mdx,
      slug,
      url: `/posts/${slug}`,
    };
  },
});

export default defineConfig({
  collections: [posts],
});
```

Aktualizujte soubor `next.config.js`:

```javascript
const { withContentCollections } = require("@content-collections/next");

/** @type {import('next').NextConfig} */
const nextConfig = {
  // vaÅ¡e stÃ¡vajÃ­cÃ­ konfigurace...
};

module.exports = withContentCollections(nextConfig);
```

Aktualizujte cesty v souboru `tsconfig.json`:

```json
{
  "compilerOptions": {
    // ... ostatnÃ­ moÅ¾nosti
    "paths": {
      "@/*": ["./src/*"],
      "content-collections": ["./.content-collections/generated"]
    }
  }
}
```


## UkÃ¡zkovÃ½ obsah

VytvoÅ™te adresÃ¡Å™ `content/` v koÅ™enovÃ©m adresÃ¡Å™i projektu a pÅ™idejte `content/hello-world.mdx`:

````markdown
---
title: "Ahoj svÄ›te"
description: "MÅ¯j prvnÃ­ blogovÃ½ pÅ™Ã­spÄ›vek s podporou raw markdown."
date: "2024-12-20"
---

## VÃ­tejte

Toto je mÅ¯j prvnÃ­ blogovÃ½ pÅ™Ã­spÄ›vek! Tady mÃ¡te **tuÄnÃ½ text** a blok kÃ³du:

```javascript
console.log("Ahoj, svÄ›te!");
```

Docela fajn, ne?
````


## StrÃ¡nky pÅ™Ã­spÄ›vkÅ¯

NahraÄte soubor `app/page.tsx`:

```tsx
import { allPosts } from "content-collections";
import Link from "next/link";

export default function Home() {
  const sortedPosts = allPosts.sort(
    (a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()
  );

  return (
    <div className="max-w-2xl mx-auto p-8">
      <h1 className="text-3xl font-bold mb-8">MÅ¯j blog</h1>
      <div className="space-y-6">
        {sortedPosts.map((post) => (
          <article key={post.slug} className="border-b pb-4">
            <Link
              href={post.url}
              className="text-xl font-semibold hover:text-blue-600"
            >
              {post.title}
            </Link>
            <p className="text-gray-600 mt-2">{post.description}</p>
            <time className="text-sm text-gray-500">
              {post.date.toLocaleDateString()}
            </time>
            <div className="mt-2 text-sm">
              <Link
                href={`${post.url}.md`}
                className="text-blue-500 hover:underline"
              >
                Zobrazit zdrojovÃ½ markdown
              </Link>
            </div>
          </article>
        ))}
      </div>
    </div>
  );
}
```

VytvoÅ™te soubor `app/posts/[slug]/page.tsx`:

```tsx
import { allPosts } from "content-collections";
import { MDXContent } from "@content-collections/mdx/react";
import { notFound } from "next/navigation";
import Link from "next/link";

export default async function PostPage({
  params,
}: {
  params: Promise<{ slug: string }>;
}) {
  const { slug } = await params;
  const post = allPosts.find((p) => p.slug === slug);

  if (!post) notFound();

  return (
    <div className="max-w-2xl mx-auto p-8">
      <Link
        href="/"
        className="text-blue-600 hover:underline mb-4 inline-block"
      >
        â† ZpÄ›t na pÅ™Ã­spÄ›vky
      </Link>

      <article>
        <header className="mb-8">
          <h1 className="text-3xl font-bold mb-2">{post.title}</h1>
          <p className="text-gray-600 mb-2">{post.description}</p>
          <time className="text-sm text-gray-500">
            {post.date.toLocaleDateString()}
          </time>
          <div className="mt-4">
            <Link
              href={`${post.url}.md`}
              className="text-blue-500 hover:underline text-sm"
            >
              Zobrazit zdrojovÃ½ markdown
            </Link>
          </div>
        </header>

        <div className="prose prose-lg max-w-none">
          <MDXContent code={post.mdx} />
        </div>
      </article>
    </div>
  );
}

export function generateStaticParams() {
  return allPosts.map((post) => ({ slug: post.slug }));
}
```


## To kouzlo: Rewrites

Tady Next.js rewrites zÃ¡Å™Ã­ â€“ pÅ™episovÃ¡nÃ­ URL mÅ¯Å¾eme elegantnÄ› vyÅ™eÅ¡it jen nÄ›kolika Å™Ã¡dky konfigurace.

Aktualizujte `next.config.js` a pÅ™idejte pravidlo pro pÅ™epis:

```javascript
const { withContentCollections } = require("@content-collections/next");

/** @type {import('next').NextConfig} */
const nextConfig = {
  async rewrites() {
    return [
      {
        source: "/posts/:slug.md",
        destination: "/api/posts/:slug/raw",
      },
    ];
  },
};

module.exports = withContentCollections(nextConfig);
```

PÅ™episovacÃ­ pravidlo automaticky mapuje kaÅ¾dÃ½ poÅ¾adavek odpovÃ­dajÃ­cÃ­ `/posts/:slug.md` na `/api/posts/:slug/raw`. Parametr `:slug` se zÃ­skÃ¡ ze zdrojovÃ© adresy URL a pÅ™edÃ¡ se na cÃ­lovou. UÅ¾ivatel ve svÃ©m prohlÃ­Å¾eÄi vidÃ­ `/posts/hello-world.md`, ale Next.js jej ve skuteÄnosti obsluhuje z `/api/posts/hello-world/raw`.


## Trasa API pro neformÃ¡tovanÃ½ obsah

VytvoÅ™te `app/api/posts/[slug]/raw/route.ts`:

```typescript
import { allPosts } from "content-collections";
import { NextRequest, NextResponse } from "next/server";

export async function GET(
  request: NextRequest,
  { params }: { params: Promise<{ slug: string }> }
) {
  const { slug } = await params;
  const post = allPosts.find((p) => p.slug === slug);

  if (!post) {
    return new NextResponse("PÅ™Ã­spÄ›vek nebyl nalezen", { status: 404 });
  }

  return new NextResponse(post.content, {
    headers: {
      "Content-Type": "text/markdown; charset=utf-8",
      "Cache-Control": "public, max-age=3600", // Cache na 1 hodinu
    },
  });
}

export function generateStaticParams() {
  return allPosts.map((post) => ({ slug: post.slug }));
}
```


## Hotovo

SpusÅ¥te svÅ¯j vÃ½vojovÃ½ server a otestujte obÄ› adresy URL:

- `/posts/hello-world` â€“ vykreslenÃ© MDX se styly a komponentami
- `/posts/hello-world.md` â€“ syrovÃ½ (raw) zdroj markdownu

ZÃ¡hlavÃ­ cache zajistÃ­, Å¾e se syrovÃ½ markdown bude hodinu uklÃ¡dat do mezipamÄ›ti, coÅ¾ sniÅ¾uje zÃ¡tÄ›Å¾ serveru u populÃ¡rnÃ­ch pÅ™Ã­spÄ›vkÅ¯. V produkci moÅ¾nÃ¡ budete chtÃ­t k pÅ™Ã­spÄ›vkÅ¯m pÅ™idat tlaÄÃ­tko â€Zobrazit rawâ€œ (jako mÃ¡m na svÃ©m blogu), mÃ­sto pouhÃ©ho odkazu v seznamu pÅ™Ã­spÄ›vkÅ¯.

Tahle funkce je skvÄ›lÃ¡ pro sdÃ­lenÃ­ pÅ™Ã­kladÅ¯, ladÄ›nÃ­ obsahu nebo pro to, aby si ostatnÃ­ mohli prostudovat vaÅ¡e formÃ¡tovÃ¡nÃ­ v markdownu. A pÅ™episy v Next.js dÄ›lajÃ­ implementaci Äistou a rychlou â€“ nenÃ­ potÅ™eba Å¾Ã¡dnÃ¡ sloÅ¾itÃ¡ routovacÃ­ logika.